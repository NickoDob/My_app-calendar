{"ast":null,"code":"import { useCallback } from 'react';\nimport useVersion from '../useVersion';\nimport { useCheckMinimumRequiredProps } from '../checkMinimumRequiredProps';\nimport { useNotify, useRedirect, useRefresh } from '../../sideEffect';\nimport { useGetOne, useUpdate } from '../../dataProvider';\nimport { useTranslate } from '../../i18n';\nimport { CRUD_GET_ONE, CRUD_UPDATE } from '../../actions';\nimport { useSaveModifiers } from '../saveModifiers';\nimport { useResourceContext, useGetResourceLabel } from '../../core';\n/**\n * Prepare data for the Edit view\n *\n * @param {Object} props The props passed to the Edit component.\n *\n * @return {Object} controllerProps Fetched data and callbacks for the Edit view\n *\n * @example\n *\n * import { useEditController } from 'react-admin';\n * import EditView from './EditView';\n *\n * const MyEdit = props => {\n *     const controllerProps = useEditController(props);\n *     return <EditView {...controllerProps} {...props} />;\n * }\n */\n\nexport var useEditController = function useEditController(props) {\n  useCheckMinimumRequiredProps('Edit', ['basePath', 'resource'], props);\n  var basePath = props.basePath,\n      hasCreate = props.hasCreate,\n      hasEdit = props.hasEdit,\n      hasList = props.hasList,\n      hasShow = props.hasShow,\n      id = props.id,\n      successMessage = props.successMessage,\n      // @deprecated use mutationMode: undoable instead\n  _a = props.undoable,\n      // @deprecated use mutationMode: undoable instead\n  undoable = _a === void 0 ? true : _a,\n      onSuccess = props.onSuccess,\n      onFailure = props.onFailure,\n      _b = props.mutationMode,\n      mutationMode = _b === void 0 ? undoable ? 'undoable' : undefined : _b,\n      transform = props.transform;\n  var resource = useResourceContext(props);\n  var translate = useTranslate();\n  var notify = useNotify();\n  var redirect = useRedirect();\n  var refresh = useRefresh();\n  var version = useVersion();\n\n  if (process.env.NODE_ENV !== 'production' && successMessage) {\n    console.log('<Edit successMessage> prop is deprecated, use the onSuccess prop instead.');\n  }\n\n  var _c = useSaveModifiers({\n    onSuccess: onSuccess,\n    onFailure: onFailure,\n    transform: transform\n  }),\n      onSuccessRef = _c.onSuccessRef,\n      setOnSuccess = _c.setOnSuccess,\n      onFailureRef = _c.onFailureRef,\n      setOnFailure = _c.setOnFailure,\n      transformRef = _c.transformRef,\n      setTransform = _c.setTransform;\n\n  var _d = useGetOne(resource, id, {\n    action: CRUD_GET_ONE,\n    onFailure: function onFailure() {\n      notify('ra.notification.item_doesnt_exist', 'warning');\n      redirect('list', basePath);\n      refresh();\n    }\n  }),\n      record = _d.data,\n      loading = _d.loading,\n      loaded = _d.loaded,\n      refetch = _d.refetch;\n\n  var getResourceLabel = useGetResourceLabel();\n  var defaultTitle = translate('ra.page.edit', {\n    name: getResourceLabel(resource, 1),\n    id: id,\n    record: record\n  });\n\n  var _e = useUpdate(resource, id, {}, // set by the caller\n  record),\n      update = _e[0],\n      saving = _e[1].loading;\n\n  var save = useCallback(function (data, redirectTo, _a) {\n    if (redirectTo === void 0) {\n      redirectTo = DefaultRedirect;\n    }\n\n    var _b = _a === void 0 ? {} : _a,\n        onSuccessFromSave = _b.onSuccess,\n        onFailureFromSave = _b.onFailure,\n        transformFromSave = _b.transform;\n\n    return Promise.resolve(transformFromSave ? transformFromSave(data) : transformRef.current ? transformRef.current(data) : data).then(function (data) {\n      return update({\n        payload: {\n          data: data\n        }\n      }, {\n        action: CRUD_UPDATE,\n        onSuccess: onSuccessFromSave ? onSuccessFromSave : onSuccessRef.current ? onSuccessRef.current : function () {\n          notify(successMessage || 'ra.notification.updated', 'info', {\n            smart_count: 1\n          }, mutationMode === 'undoable');\n          redirect(redirectTo, basePath, data.id, data);\n        },\n        onFailure: onFailureFromSave ? onFailureFromSave : onFailureRef.current ? onFailureRef.current : function (error) {\n          notify(typeof error === 'string' ? error : error.message || 'ra.notification.http_error', 'warning', {\n            _: typeof error === 'string' ? error : error && error.message ? error.message : undefined\n          });\n\n          if (mutationMode === 'undoable' || mutationMode === 'pessimistic') {\n            refresh();\n          }\n        },\n        mutationMode: mutationMode\n      });\n    });\n  }, [transformRef, update, onSuccessRef, onFailureRef, notify, successMessage, redirect, basePath, refresh, mutationMode]);\n  return {\n    loading: loading,\n    loaded: loaded,\n    saving: saving,\n    defaultTitle: defaultTitle,\n    hasCreate: hasCreate,\n    hasEdit: hasEdit,\n    hasList: hasList,\n    hasShow: hasShow,\n    onSuccessRef: onSuccessRef,\n    onFailureRef: onFailureRef,\n    transformRef: transformRef,\n    save: save,\n    setOnSuccess: setOnSuccess,\n    setOnFailure: setOnFailure,\n    setTransform: setTransform,\n    refetch: refetch,\n    resource: resource,\n    basePath: basePath,\n    record: record,\n    redirect: DefaultRedirect,\n    version: version\n  };\n};\nvar DefaultRedirect = 'list';","map":null,"metadata":{},"sourceType":"module"}