{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { isValidElement, useEffect, useMemo } from 'react';\nimport { useCheckMinimumRequiredProps } from './checkMinimumRequiredProps';\nimport useListParams from './useListParams';\nimport useRecordSelection from './useRecordSelection';\nimport useTranslate from '../i18n/useTranslate';\nimport useNotify from '../sideEffect/useNotify';\nimport { useGetMainList } from '../dataProvider/useGetMainList';\nimport { SORT_ASC } from '../reducer/admin/resource/list/queryReducer';\nimport { CRUD_GET_LIST } from '../actions';\nimport defaultExporter from '../export/defaultExporter';\nimport { useResourceContext, useGetResourceLabel } from '../core';\nvar defaultSort = {\n  field: 'id',\n  order: SORT_ASC\n};\n/**\n * Prepare data for the List view\n *\n * @param {Object} props The props passed to the List component.\n *\n * @return {Object} controllerProps Fetched and computed data for the List view\n *\n * @example\n *\n * import { useListController } from 'react-admin';\n * import ListView from './ListView';\n *\n * const MyList = props => {\n *     const controllerProps = useListController(props);\n *     return <ListView {...controllerProps} {...props} />;\n * }\n */\n\nvar useListController = function useListController(props) {\n  useCheckMinimumRequiredProps('List', ['basePath'], props);\n  var basePath = props.basePath,\n      _a = props.exporter,\n      exporter = _a === void 0 ? defaultExporter : _a,\n      filterDefaultValues = props.filterDefaultValues,\n      hasCreate = props.hasCreate,\n      _b = props.sort,\n      sort = _b === void 0 ? defaultSort : _b,\n      _c = props.perPage,\n      perPage = _c === void 0 ? 10 : _c,\n      filter = props.filter,\n      _d = props.debounce,\n      debounce = _d === void 0 ? 500 : _d,\n      syncWithLocation = props.syncWithLocation;\n  var resource = useResourceContext(props);\n\n  if (!resource) {\n    throw new Error(\"<List> was called outside of a ResourceContext and without a resource prop. You must set the resource prop.\");\n  }\n\n  if (filter && isValidElement(filter)) {\n    throw new Error('<List> received a React element as `filter` props. If you intended to set the list filter elements, use the `filters` (with an s) prop instead. The `filter` prop is internal and should not be set by the developer.');\n  }\n\n  var translate = useTranslate();\n  var notify = useNotify();\n\n  var _e = useListParams({\n    resource: resource,\n    filterDefaultValues: filterDefaultValues,\n    sort: sort,\n    perPage: perPage,\n    debounce: debounce,\n    syncWithLocation: syncWithLocation\n  }),\n      query = _e[0],\n      queryModifiers = _e[1];\n\n  var _f = useRecordSelection(resource),\n      selectedIds = _f[0],\n      selectionModifiers = _f[1];\n  /**\n   * We want the list of ids to be always available for optimistic rendering,\n   * and therefore we need a custom action (CRUD_GET_LIST) that will be used.\n   */\n\n\n  var _g = useGetMainList(resource, {\n    page: query.page,\n    perPage: query.perPage\n  }, {\n    field: query.sort,\n    order: query.order\n  }, __assign(__assign({}, query.filter), filter), {\n    action: CRUD_GET_LIST,\n    onFailure: function onFailure(error) {\n      return notify(typeof error === 'string' ? error : error.message || 'ra.notification.http_error', 'warning', {\n        _: typeof error === 'string' ? error : error && error.message ? error.message : undefined\n      });\n    }\n  }),\n      ids = _g.ids,\n      data = _g.data,\n      total = _g.total,\n      error = _g.error,\n      loading = _g.loading,\n      loaded = _g.loaded,\n      refetch = _g.refetch;\n\n  var totalPages = Math.ceil(total / query.perPage) || 1;\n  useEffect(function () {\n    if (query.page <= 0 || !loading && query.page > 1 && ids.length === 0) {\n      // Query for a page that doesn't exist, set page to 1\n      queryModifiers.setPage(1);\n    } else if (!loading && query.page > totalPages) {\n      // Query for a page out of bounds, set page to the last existing page\n      // It occurs when deleting the last element of the last page\n      queryModifiers.setPage(totalPages);\n    }\n  }, [loading, query.page, ids, queryModifiers, total, totalPages]);\n  var currentSort = useMemo(function () {\n    return {\n      field: query.sort,\n      order: query.order\n    };\n  }, [query.sort, query.order]);\n  var getResourceLabel = useGetResourceLabel();\n  var defaultTitle = translate('ra.page.list', {\n    name: getResourceLabel(resource, 2)\n  });\n  return {\n    basePath: basePath,\n    currentSort: currentSort,\n    data: data,\n    defaultTitle: defaultTitle,\n    displayedFilters: query.displayedFilters,\n    error: error,\n    exporter: exporter,\n    filter: filter,\n    filterValues: query.filterValues,\n    hasCreate: hasCreate,\n    hideFilter: queryModifiers.hideFilter,\n    ids: ids,\n    loaded: loaded || ids.length > 0,\n    loading: loading,\n    onSelect: selectionModifiers.select,\n    onToggleItem: selectionModifiers.toggle,\n    onUnselectItems: selectionModifiers.clearSelection,\n    page: query.page,\n    perPage: query.perPage,\n    refetch: refetch,\n    resource: resource,\n    selectedIds: selectedIds,\n    setFilters: queryModifiers.setFilters,\n    setPage: queryModifiers.setPage,\n    setPerPage: queryModifiers.setPerPage,\n    setSort: queryModifiers.setSort,\n    showFilter: queryModifiers.showFilter,\n    total: total\n  };\n};\n\nexport var injectedProps = ['basePath', 'currentSort', 'data', 'defaultTitle', 'displayedFilters', 'error', 'exporter', 'filterValues', 'hasCreate', 'hideFilter', 'ids', 'loading', 'loaded', 'onSelect', 'onToggleItem', 'onUnselectItems', 'page', 'perPage', 'refetch', 'refresh', 'resource', 'selectedIds', 'setFilters', 'setPage', 'setPerPage', 'setSort', 'showFilter', 'total', 'totalPages', 'version'];\n/**\n * Select the props injected by the useListController hook\n * to be passed to the List children need\n * This is an implementation of pick()\n */\n\nexport var getListControllerProps = function getListControllerProps(props) {\n  return injectedProps.reduce(function (acc, key) {\n    var _a;\n\n    return __assign(__assign({}, acc), (_a = {}, _a[key] = props[key], _a));\n  }, {});\n};\n/**\n * Select the props not injected by the useListController hook\n * to be used inside the List children to sanitize props injected by List\n * This is an implementation of omit()\n */\n\nexport var sanitizeListRestProps = function sanitizeListRestProps(props) {\n  return Object.keys(props).filter(function (propName) {\n    return !injectedProps.includes(propName);\n  }).reduce(function (acc, key) {\n    var _a;\n\n    return __assign(__assign({}, acc), (_a = {}, _a[key] = props[key], _a));\n  }, {});\n};\nexport default useListController;","map":null,"metadata":{},"sourceType":"module"}